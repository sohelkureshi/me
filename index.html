<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sohel Kureshi | Portfolio</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="64x64" href="assets/images/favicon/icons8-portfolio-32.png" />

  <!-- Prevent FOUC: hide until CSS+fonts are ready -->
  <style>
    html:not(.css-ready) { visibility: hidden; }
  </style>

  <!-- Resource hints -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />

  <!-- Critical/base CSS -->
  <link rel="preload" href="css/base.css" as="style" />
  <link rel="stylesheet" href="css/base.css" />

  <!-- Page CSS -->
  <link rel="stylesheet" href="css/about.css" />
  <link rel="stylesheet" href="css/experience.css" />
  <link rel="stylesheet" href="css/projects.css" />
  <link rel="stylesheet" href="css/skills.css" />
  <link rel="stylesheet" href="css/education.css" />
  <link rel="stylesheet" href="css/services.css" />
  <link rel="stylesheet" href="css/contact.css" />
  <link rel="stylesheet" href="css/resume.css" />

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

  <!-- Minimal transitions used by your loader -->
  <style>
    /* duplicates exist in base.css, but harmless if kept here */
    #main-content { transition: opacity 0.3s ease; min-height: 400px; }
    .loading-state { opacity: 0.5; pointer-events: none; }
    .fade-out { opacity: 0; }
    .fade-in { opacity: 1; }
  </style>

  <!-- Reveal the page only after all stylesheets and fonts are ready -->
  <script>
    (function () {
      function revealWhenStylesReady() {
        const links = Array.from(document.querySelectorAll('link[rel="stylesheet"]'));
        const linkPromises = links.map(link => new Promise(resolve => {
          if (link.sheet) return resolve();
          link.addEventListener('load', resolve, { once: true });
          link.addEventListener('error', resolve, { once: true });
        }));
        const fontsReady = (document.fonts && document.fonts.ready) ? document.fonts.ready : Promise.resolve();
        Promise.all([...linkPromises, fontsReady]).then(() => {
          document.documentElement.classList.add('css-ready');
        });
      }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', revealWhenStylesReady);
      } else {
        revealWhenStylesReady();
      }
    })();
  </script>

  <noscript><style>html { visibility: visible; }</style></noscript>
</head>
<body>
  <nav>
    <!-- Mobile hamburger button -->
    <div class="nav-toggle" id="nav-toggle">
      <i class="bi bi-list"></i>
    </div>

    <!-- Navigation menu -->
    <ul class="nav-menu" id="nav-menu">
      <li><a href="#" data-page="about.html" class="nav-link active">About</a></li>
      <li><a href="#" data-page="experience.html" class="nav-link">Experience</a></li>
      <li><a href="#" data-page="projects.html" class="nav-link">Projects</a></li>
      <li><a href="#" data-page="skills.html" class="nav-link">Skills</a></li>
      <li><a href="#" data-page="education.html" class="nav-link">Education</a></li>
      <li><a href="#" data-page="services.html" class="nav-link">Services</a></li>
      <li><a href="#" data-page="contact.html" class="nav-link">Contact</a></li>
      <li><a href="#" data-page="resume.html" class="nav-link">Resume</a></li>
    </ul>
  </nav>

  <main id="main-content" class="fade-in">
    <!-- Content will be loaded dynamically -->
  </main>

  <footer>
    &copy; 2025 Sohel Kureshi
  </footer>

  <script>
    // Anti-glitch variables
    let isLoading = false;
    let currentPage = '';

    // Mobile menu toggle functionality
    const navToggle = document.getElementById('nav-toggle');
    const navMenu = document.getElementById('nav-menu');

    navToggle.addEventListener('click', () => {
      const willShow = !navMenu.classList.contains('show-menu');
      navMenu.classList.toggle('show-menu', willShow);

      // Lock/unlock body scroll without breaking sticky
      document.body.classList.toggle('menu-open', willShow);

      // Toggle hamburger icon
      const icon = navToggle.querySelector('i');
      if (icon) icon.className = willShow ? 'bi bi-x' : 'bi bi-list';
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
        navMenu.classList.remove('show-menu');
        document.body.classList.remove('menu-open');
        const icon = navToggle.querySelector('i');
        if (icon) icon.className = 'bi bi-list';
      }
    });

    // Page loading functionality
    const links = document.querySelectorAll('nav a.nav-link');
    const mainContent = document.getElementById('main-content');

    // Smooth page loading function with anti-glitch measures
    function loadPage(page, linkElement) {
      if (isLoading || currentPage === page) return;

      isLoading = true;
      currentPage = page;

      mainContent.classList.add('loading-state');
      mainContent.classList.remove('fade-in');
      mainContent.classList.add('fade-out');

      setTimeout(() => {
        fetch(page)
          .then(response => {
            if (!response.ok) throw new Error('Page not found');
            return response.text();
          })
          .then(data => {
            mainContent.innerHTML = data;
            window.scrollTo(0, 0);

            links.forEach(link => link.classList.remove('active'));
            if (linkElement) linkElement.classList.add('active');

            // Close mobile menu after selection
            navMenu.classList.remove('show-menu');
            document.body.classList.remove('menu-open');
            const icon = navToggle.querySelector('i');
            if (icon) icon.className = 'bi bi-list';

            mainContent.classList.remove('fade-out', 'loading-state');
            mainContent.classList.add('fade-in');

            attachDynamicEventListeners();

            isLoading = false;
          })
          .catch(() => {
            mainContent.innerHTML = '<p>Sorry, the content could not be loaded.</p>';
            mainContent.classList.remove('fade-out', 'loading-state');
            mainContent.classList.add('fade-in');
            isLoading = false;
            currentPage = '';
          });
      }, 150);
    }

    // Function to attach event listeners to dynamically loaded content
    function attachDynamicEventListeners() {
      const dynamicLinks = document.querySelectorAll('[data-page]');
      dynamicLinks.forEach(link => {
        link.removeEventListener('click', handleDynamicClick);
        link.addEventListener('click', handleDynamicClick);
      });
    }

    // Handle clicks on dynamically loaded content
    function handleDynamicClick(e) {
      e.preventDefault();
      const page = this.getAttribute('data-page');
      if (page && !isLoading) {
        loadPage(page, null);
      }
    }

    // Add click event listeners to navigation links
    links.forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const page = link.getAttribute('data-page');
        if (page && !isLoading) {
          loadPage(page, link);
        }
      });
    });

    // Load about.html immediately as default page
    window.addEventListener('DOMContentLoaded', () => {
      const aboutLink = document.querySelector('a[data-page="about.html"]');
      isLoading = true;
      currentPage = 'about.html';

      fetch('about.html')
        .then(response => {
          if (!response.ok) throw new Error('Page not found');
          return response.text();
        })
        .then(data => {
          mainContent.innerHTML = data;
          if (aboutLink) aboutLink.classList.add('active');
          attachDynamicEventListeners();
          isLoading = false;
        })
        .catch(() => {
          mainContent.innerHTML = '<p>Welcome! Please navigate using the menu above.</p>';
          isLoading = false;
          currentPage = '';
        });
    });

    // Prevent rapid clicking
    document.addEventListener('click', (e) => {
      if (isLoading && e.target.hasAttribute('data-page')) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    }, true);
  </script>
</body>
</html>
